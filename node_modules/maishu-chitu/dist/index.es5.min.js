/*!
 * 
 *  maishu-chitu v3.27.0
 *  https://github.com/ansiboy/chitu
 *  
 *  Copyright (c) 2016-2018, shu mai <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("maishu-chitu-service"));else if("function"==typeof define&&define.amd)define(["maishu-chitu-service"],t);else{var n="object"==typeof exports?t(require("maishu-chitu-service")):t(e["maishu-chitu-service"]);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}("undefined"==typeof window?global:window,function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(t,n){t.exports=e},function(e,t,n){"use strict";var r,a;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}r=[n,t,n(0),n(3),n(2)],void 0===(a=function(e,t,n,r,a){Object.defineProperty(t,"__esModule",{value:!0});var o="index";function l(e){if(!e)throw a.Errors.argumentNull("url");var t,n,r=e.indexOf("#");if(!(t=r>=0?e.substr(r+1):e))throw a.Errors.canntParseRouteString(e);if(t.startsWith("!"))throw a.Errors.canntParseRouteString(t);var i=null,u=t.indexOf("?");u>=0?(i=t.substr(u+1),n=t.substring(0,u)):n=t,n||(n=o);var s={};return i&&(s=function(e){var t,n=/\+/g,r=/([^&=]+)=?([^&]*)/g,a=function(e){return decodeURIComponent(e.replace(n," "))},o={};for(;t=r.exec(e);)o[a(t[1])]=a(t[2]);return o}(i)),{pageName:n,values:s}}function f(e,t){var n=e.split(".").join("/");if(!t)return"".concat(n);var r="";for(var a in t){var o=t[a];"function"!=typeof o&&null!=o&&(o=encodeURIComponent(o),r=""==r?"?".concat(a,"=").concat(o):r+"&".concat(a,"=").concat(o))}return"".concat(n).concat(r)}t.parseUrl=l,t.createPageUrl=f;var h=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=u(this,s(t).call(this,t.containers((e||{}).container),(e||{}).parser)))._runned=!1,n}var h,p,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,r.PageMaster),h=t,v=[{key:"containers",value:function(e){var n={};if(null==e)return n[t.DefaultContainerName]=document.body,n;if(e.tagName)return n[t.DefaultContainerName]=e,n;if(n=e,!t.DefaultContainerName)throw a.Errors.containerIsNotExists(t.DefaultContainerName);return n}}],(p=[{key:"parseUrl",value:function(e){if(!e)throw a.Errors.argumentNull("url");return l(e)}},{key:"createUrl",value:function(e,t){return f(e,t)}},{key:"run",value:function(){var e=this;if(!this._runned){var t=function(){var t=location.href,n=t.indexOf("#");(t=n<0?"#"+o:t.substr(n+1)).startsWith("!")||e.showPage(t)};t(),window.addEventListener("hashchange",function(){e.location.skip?delete e.location.skip:t()}),this._runned=!0}}},{key:"setLocationHash",value:function(e){this.location.hash="#".concat(e),this.location.skip=!0}},{key:"redirect",value:function(e,t){if(!e)throw a.Errors.argumentNull("pageUrl");var n=this.showPage(e,t),r=this.createUrl(n.name,n.data);return this.setLocationHash(r),n}},{key:"forward",value:function(e,t,n){if(!e)throw a.Errors.argumentNull("pageNameOrUrl");null==n&&(n=!0);var r=this.showPage(e,t,!0);if(n){var o=this.createUrl(r.name,r.data);this.setLocationHash(o)}return r}},{key:"back",value:function(){this.closeCurrentPage(),setTimeout(function(){history.back()},100)}},{key:"createService",value:function(e){var t=this,r=new(e=e||n.Service);return r.error.add(function(e,n){t.error.fire(t,n,null)}),r}},{key:"location",get:function(){return location}}])&&i(h.prototype,p),v&&i(h,v),t}();t.Application=h,h.DefaultContainerName="default"}.apply(t,r))||(e.exports=a)},function(e,t,n){"use strict";var r;function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}void 0===(r=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"pageNodeNotExists",value:function(e){var t="Page node named ".concat(e," is not exists.");return new Error(t)}},{key:"actionCanntNull",value:function(e){var t="Action of '".concat(e,"' can not be null.");return new Error(t)}},{key:"argumentNull",value:function(e){var t='The argument "'.concat(e,'" cannt be null.');return new Error(t)}},{key:"modelFileExpecteFunction",value:function(e){var t='The eval result of script file "'.concat(e,'" is expected a function.');return new Error(t)}},{key:"paramTypeError",value:function(e,t){var n='The param "'.concat(e,'" is expected "').concat(t,'" type.');return new Error(n)}},{key:"paramError",value:function(e){return new Error(e)}},{key:"pathPairRequireView",value:function(e){var t='The view value is required for path pair, but the item with index "'.concat(e,'" is miss it.');return new Error(t)}},{key:"notImplemented",value:function(e){var t="'The method \"".concat(e,"\" is not implemented.'");return new Error(t)}},{key:"routeExists",value:function(e){var t='Route named "'.concat(e,'" is exists.');return new Error(t)}},{key:"noneRouteMatched",value:function(e){var t='None route matched with url "'.concat(e,'".');return new Error(t)}},{key:"emptyStack",value:function(){return new Error("The stack is empty.")}},{key:"canntParseUrl",value:function(e){var t='Can not parse the url "'.concat(e,'" to route data.');return new Error(t)}},{key:"canntParseRouteString",value:function(e){var t='Can not parse the route string "'.concat(e,'" to route data.;');return new Error(t)}},{key:"routeDataRequireController",value:function(){return new Error('The route data does not contains a "controller" file.')}},{key:"routeDataRequireAction",value:function(){return new Error('The route data does not contains a "action" file.')}},{key:"viewCanntNull",value:function(){return new Error("The view or viewDeferred of the page cannt null.")}},{key:"createPageFail",value:function(e){var t='Create page "'.concat(e,'" fail.');return new Error(t)}},{key:"actionTypeError",value:function(e){var t="The action in page '".concat(e,"' is expect as function.");return new Error(t)}},{key:"canntFindAction",value:function(e){var t="Cannt find action in page '".concat(e,"', is the exports has default field?");return new Error(t)}},{key:"exportsCanntNull",value:function(e){var t="Exports of page '".concat(e,"' is null.");return new Error(t)}},{key:"scrollerElementNotExists",value:function(){return new Error("Scroller element is not exists.")}},{key:"resourceExists",value:function(e,t){var n="Rosource '".concat(e,"' is exists in the resources of page '").concat(t,"'.");return new Error(n)}},{key:"siteMapRootCanntNull",value:function(){return new Error("The site map root node can not be null.")}},{key:"duplicateSiteMapNode",value:function(e){var t="The site map node ".concat(e," is exists.");return new Error(t)}},{key:"unexpectedNullValue",value:function(){return new Error("Unexpected null value.")}},{key:"containerIsNotExists",value:function(e){var t="Container '".concat(e,"' is not exists");return new Error(t)}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();t.Errors=n}.apply(t,[n,t]))||(e.exports=r)},function(e,t,n){"use strict";var r,a;function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function u(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,u)}s((r=r.apply(e,t||[])).next())})};r=[n,t,n(0),n(4),n(1),n(2)],void 0===(a=function(e,t,n,r,a,u){Object.defineProperty(t,"__esModule",{value:!0});var s,c=function(){function e(t,a){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pageCreated=n.Callbacks(),this.pageShowing=n.Callbacks(),this.pageShown=n.Callbacks(),this.pageType=r.Page,this.pageDisplayType=r.PageDisplayerImplement,this.cachePages={},this.page_stack=new Array,this.nodes={},this.MAX_PAGE_COUNT=100,this.pageTagName="div",this.pagePlaceholder=e.defaultPagePlaceholder,this.error=n.Callbacks(),this._defaultPageNodeParser=null,this.parser=a||this.defaultPageNodeParser,!t)throw u.Errors.argumentNull("containers");this.parser.actions=this.parser.actions||{},this.containers=t,this.pageContainers={}}var t,s,c;return t=e,(s=[{key:"sendMessage",value:function(e,t,n){("string"==typeof t?this.page_stack.filter(function(e){return e.name==t}):this.page_stack.filter(function(e){return e instanceof t})).forEach(function(t){t.messageReceived.fire(e,n)})}},{key:"createDefaultAction",value:function(t,n){var r=this;return function(a){return i(r,void 0,void 0,regeneratorRuntime.mark(function r(){var o,i,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,n(t);case 2:if(o=r.sent){r.next=5;break}throw u.Errors.exportsCanntNull(t);case 5:if(null!=(i=o.default)){r.next=8;break}throw u.Errors.canntFindAction(a.name);case 8:return s=e.isClass(i)?new i(a,this):i(a,this),r.abrupt("return",s);case 10:case"end":return r.stop()}},r,this)}))}}},{key:"loadjs",value:function(e){return new Promise(function(t,n){requirejs([e],function(e){t(e)},function(e){n(e)})})}},{key:"on_pageCreated",value:function(e){return this.pageCreated.fire(this,e)}},{key:"cachePageKey",value:function(e,t){return"".concat(e,"_").concat(t)}},{key:"getPage",value:function(e,t,n){if(!e)throw u.Errors.argumentNull("pageUrl");var r=this.cachePageKey(t,e);n=n||{};var o=this.cachePages[r];if(null!=o){var i=a.parseUrl(e);return o.data=Object.assign(n||{},i.values),{page:o,isNew:!1}}var s=this.createPage(e,t,n);return this.cachePages[r]=s,this.on_pageCreated(s),{page:s,isNew:!0}}},{key:"createPage",value:function(e,t,n){var r=this;if(!e)throw u.Errors.argumentNull("pageUrl");if(!t)throw u.Errors.argumentNull("containerName");n=n||{};var o=a.parseUrl(e),i=this.createPageElement(o.pageName,t),s=new this.pageDisplayType(this),c=this.containers[t];if(!c)throw u.Errors.containerIsNotExists(t);console.assert(null!=this.pageType);var l=new this.pageType({app:this,url:e,data:n,displayer:s,element:i,container:{name:t,element:c}}),f=function(e){for(var t in r.containers)t==e.container.name?e.container.element.style.removeProperty("display"):r.containers[t].style.display="none";r.pageShowing.fire(r,e)},h=function(e){r.pageShown.fire(r,e)};return l.showing.add(f),l.shown.add(h),l.closed.add(function(){l.showing.remove(f),l.shown.remove(h);var e=r.cachePageKey(l.container.name,l.url);delete r.cachePages[e],r.page_stack=r.page_stack.filter(function(e){return e!=l})}),l}},{key:"createPageElement",value:function(e,t){if(!t)throw u.Errors.argumentNull("containerName");var n=this.containers[t];if(!n)throw u.Errors.containerIsNotExists(t);var r=n.querySelector(".".concat(this.pagePlaceholder));null==r&&(r=n);var a=document.createElement(this.pageTagName);return r.appendChild(a),a}},{key:"showPage",value:function(e,t,n){t=t||{},n=null!=n;var r={},o={};for(var i in t){var s=t[i];"function"==typeof s?o[i]=s:r[i]=s}var c=a.parseUrl(e);if(r=Object.assign(r,c.values),!(e=a.createPageUrl(c.pageName,r)))throw u.Errors.argumentNull("pageName");if(null!=this.currentPage&&this.currentPage.url==e)return this.currentPage;var l=r.container||this.pageContainers[c.pageName]||a.Application.DefaultContainerName,f=this.getPage(e,l,t),h=f.page;if(f.isNew||n){var p=this.findPageAction(e);if(null==p)throw u.Errors.actionCanntNull(e);p(h,this)}return h.show(),this.pushPage(h),console.assert(h==this.currentPage,"page is not current page"),h}},{key:"reload",value:function(e){var t=this.findPageAction(e.url);console.assert(null!=t),t(e,this)}},{key:"pushPage",value:function(e){if(this.page_stack.push(e),this.page_stack.length>this.MAX_PAGE_COUNT){var t=this.page_stack.shift();t&&t.close()}}},{key:"findPageAction",value:function(e){var t=a.parseUrl(e).pageName,n=this.findPageNode(t);if(null==n)throw u.Errors.pageNodeNotExists(t);if(null==n.action)throw u.Errors.actionCanntNull(t);return n.action}},{key:"findPageNode",value:function(e){if(this.nodes[e])return this.nodes[e];var t=null,n=this.parser.actions?this.parser.actions[e]:null;return null!=n&&(t={action:n,name:e}),null==t&&null!=this.parser.parse&&(t=this.parser.parse(e,this),console.assert(null!=t.action)),null!=t&&(this.nodes[e]=t),t}},{key:"closeCurrentPage",value:function(e){var t=this.page_stack.pop();null!=t&&(t.close(),this.currentPage&&(e&&(console.assert(null!=this.currentPage.data),this.currentPage.data=Object.assign(this.currentPage.data,e)),this.currentPage.show()))}},{key:"defaultPageNodeParser",get:function(){var e=this;if(null==this._defaultPageNodeParser){var t={};this._defaultPageNodeParser={actions:{},parse:function(n){var r=t[n];if(null==r){var a="modules_".concat(n).split("_").join("/");r={action:e.createDefaultAction(a,e.loadjs),name:n},t[n]=r}return r}}}return this._defaultPageNodeParser}},{key:"currentPage",get:function(){return this.page_stack.length>0?this.page_stack[this.page_stack.length-1]:null}},{key:"pageStack",get:function(){return this.page_stack}}])&&o(t.prototype,s),c&&o(t,c),e}();t.PageMaster=c,c.defaultPagePlaceholder="page-placeholder",c.isClass=(s=Function.prototype.toString,function(e){return"function"==typeof e&&(/^class(\s|\{\}$)/.test(s.call(e))||/^.*classCallCheck\(/.test(function(e){return s.call(e).replace(/^[^{]*{\s*/,"").replace(/\s*}[^}]*$/,"")}(e)))})}.apply(t,r))||(e.exports=a)},function(e,t,n){"use strict";var r,a;function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}r=[n,t,n(0),n(2),n(1)],void 0===(a=function(e,t,n,r,a){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(t){o(this,e),this.data={},this.showing=n.Callbacks(),this.shown=n.Callbacks(),this.hiding=n.Callbacks(),this.hidden=n.Callbacks(),this.closing=n.Callbacks(),this.closed=n.Callbacks(),this.messageReceived=n.Callbacks(),this._element=t.element,this._app=t.app,this._displayer=t.displayer;var r=a.parseUrl(t.url);this.data=Object.assign(r.values,t.data||{}),this._name=r.pageName,this._url=t.url,this._container=t.container}return u(e,[{key:"on_showing",value:function(){return this.showing.fire(this,this.data)}},{key:"on_shown",value:function(){return this.shown.fire(this,this.data)}},{key:"on_hiding",value:function(){return this.hiding.fire(this,this.data)}},{key:"on_hidden",value:function(){return this.hidden.fire(this,this.data)}},{key:"on_closing",value:function(){return this.closing.fire(this,this.data)}},{key:"on_closed",value:function(){return this.closed.fire(this,this.data)}},{key:"show",value:function(){var e=this;this.on_showing();var t=this._app.currentPage;return this==t&&(t=null),this._displayer.show(this,t).then(function(t){e.on_shown()})}},{key:"hide",value:function(e){var t=this;return this.on_hiding(),this._displayer.hide(this,e).then(function(e){t.on_hidden()})}},{key:"close",value:function(){this.on_closing();var e=this._element.parentElement;if(null==e)throw r.Errors.unexpectedNullValue();return e.removeChild(this._element),this.on_closed(),Promise.resolve()}},{key:"createService",value:function(e){var t=this,r=new(e=e||n.Service);return r.error.add(function(e,n){t._app.error.fire(t._app,n,t)}),r}},{key:"reload",value:function(){this.app.reload(this)}},{key:"element",get:function(){return this._element}},{key:"name",get:function(){return this._name}},{key:"url",get:function(){return this._url}},{key:"app",get:function(){return this._app}},{key:"container",get:function(){return this._container}}]),e}();t.Page=i;var s=function(){function e(){o(this,e)}return u(e,[{key:"show",value:function(e,t){return e.element.style.display="block",null!=t&&(t.element.style.display="none"),Promise.resolve()}},{key:"hide",value:function(e,t){return e.element.style.display="none",null!=t&&(t.element.style.display="block"),Promise.resolve()}}]),e}();t.PageDisplayerImplement=s}.apply(t,r))||(e.exports=a)},function(e,t,n){"use strict";var r,a;r=[n,t,n(1),n(3),n(4),n(0)],void 0===(a=function(e,t,n,r,a,o){Object.defineProperty(t,"__esModule",{value:!0}),t.Application=n.Application,t.parseUrl=n.parseUrl,t.createPageUrl=n.createPageUrl,t.PageMaster=r.PageMaster,t.Page=a.Page,t.Callback=o.Callback,t.Callbacks=o.Callbacks,t.ValueStore=o.ValueStore,t.Service=o.Service}.apply(t,r))||(e.exports=a)}])});
//# sourceMappingURL=index.es5.min.js.map