/*!
 * ~
 *  maishu-chitu-service v1.21.0
 *  
 *  Copyright (c) 2016-2018, shu mai <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["chitu-service"]=t():e["chitu-service"]=t()}("undefined"==typeof window?global:window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";r.d(t,"a",function(){return n}),r.d(t,"b",function(){return o});class n{constructor(){this.funcs=new Array}add(e){this.funcs.push(e)}remove(e){this.funcs=this.funcs.filter(t=>t!=e)}fire(...e){this.funcs.forEach(t=>t(...e))}}function o(){return new n}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Service}),__webpack_require__.d(__webpack_exports__,"b",function(){return formatData});var _callback__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_errors__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),__awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(e){i(e)}}function a(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,a)}u((n=n.apply(e,t||[])).next())})};class Service{constructor(e){this.error=Object(_callback__WEBPACK_IMPORTED_MODULE_0__.b)(),e&&this.error.add((t,r)=>{e(r,this)})}ajax(e,t){void 0===t&&(t={});let r,n=t.data,o=t.method,i=Object.assign({},t.headers||{},Service.headers);if(null!=n){if((i["content-type"]||"").indexOf("json")>=0)r=JSON.stringify(n);else{r=new URLSearchParams;for(let e in n)r.append(e,n[e])}}return new Promise((t,n)=>{let s,a={headers:i,body:r,method:o};if(null==a)throw _errors__WEBPACK_IMPORTED_MODULE_1__.a.unexpectedNullValue("options");"get"==o&&(s=setTimeout(()=>{console.warn(`timeout url: ${e}`);let t=new Error;t.name="timeout",t.message="网络连接超时",n(t),this.error.fire(this,t),clearTimeout(s)},1e3*Service.settings.ajaxTimeout)),ajax(e,a).then(e=>{t(e),s&&clearTimeout(s)}).catch(e=>{n(e),this.error.fire(this,e),s&&clearTimeout(s)})})}createService(e){let t=new(e=e||Service);return t.error.add((e,r)=>{this.error.fire(t,r)}),t}getByJson(e,t){t&&Object.getOwnPropertyNames(t).length>0&&(e=`${e}?${encodeURIComponent(JSON.stringify(t))}`);return this.ajax(e,{headers:{"content-type":"application/json"},method:"get"})}putByJson(e,t){return this.ajax(e,{headers:{"content-type":"application/json"},data:t,method:"put"})}postByJson(e,t){return this.ajax(e,{headers:{"content-type":"application/json"},data:t,method:"post"})}deleteByJson(e,t){return this.ajax(e,{headers:{"content-type":"application/json"},data:t,method:"delete"})}isEncoded(e){try{return(e=e||"")!==decodeURIComponent(e)}catch(e){return!1}}get(e,t){t=t||{};let r="";for(let e in t){if(null==t[e])continue;let n=`${t[e]}`;this.isEncoded(n)||(n=encodeURIComponent(n)),r=r?`${r}&${e}=${n}`:`${e}=${n}`}return r&&(e=`${e}?${r}`),this.ajax(e,{method:"get"})}put(e,t){return this.ajax(e,{headers:{"content-type":"application/x-www-form-urlencoded"},data:t,method:"put"})}post(e,t){return this.ajax(e,{headers:{"content-type":"application/x-www-form-urlencoded"},data:t,method:"post"})}delete(e,t){return this.ajax(e,{headers:{"content-type":"application/x-www-form-urlencoded"},data:t,method:"delete"})}}function formatData(e){if("object"==typeof e){for(let t in e)e[t]=formatData(e[t]);return e}return"string"==typeof e&&/\d{4}-\d{1,2}-\d{1,2}T\d{1,2}:\d{1,2}:\d{1,2}/.test(e)?new Date(e):e}function ajax(url,options){return __awaiter(this,void 0,void 0,function*(){let response;response="undefined"==typeof window?yield eval("require")("node-fetch")(url,options):yield fetch(url,options);let responseText=response.text(),p;p="string"==typeof responseText?new Promise((e,t)=>{e(responseText)}):responseText;let text=yield responseText,textObject,isJSONContextType=(response.headers.get("content-type")||"").indexOf("json")>=0;if(isJSONContextType)try{textObject=text?JSON.parse(text):{}}catch(e){let t=_errors__WEBPACK_IMPORTED_MODULE_1__.a.parseJSONFail(text);console.error(t),textObject=text}else textObject=text;if(response.status>=300){let e=new Error;throw e.method=options.method,e.name=`${response.status}`,e.message="string"==typeof textObject?textObject:textObject.Message||textObject.message||"",e.message=e.message||response.statusText,e}return textObject=formatData(textObject),textObject})}Service.settings={ajaxTimeout:30},Service.headers={}},function(e,t,r){"use strict";r.d(t,"a",function(){return n});let n=new class{unexpectedNullValue(e){return new Error(`variable ${e} is unexpected null value.`)}parseJSONFail(e){return new Error(`Parse json string fail:\r\n${e}`)}}},function(e,t,r){"use strict";r.r(t);var n,o=r(1),i=r(0);class s{constructor(e){this.items=new Array,this._value=e}attach(e,t){return void 0!==this.value&&e(this.value,t),this.add(e,t)}add(e,t){return this.items.push({func:e,sender:t}),e}remove(e){this.items=this.items.filter(t=>t.func!=e)}fire(e){this.items.forEach(t=>t.func(e,t.sender))}get value(){return void 0===this._value?null:this._value}set value(e){this._value=e,this.fire(e)}}class a extends s{constructor(e){super(a.loadValue(e)),this.storageName=e}get value(){return super.value}set value(e){super.value=e,a.saveValue(this.storageName,e)}static loadValue(e){let t=localStorage.getItem(e);return null==t?null:JSON.parse(t)}static saveValue(e,t){null!=t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)}}class u extends s{constructor(e){super(u.loadValue(e)),this.storageName=e}get value(){return super.value}set value(e){super.value=e,u.saveValue(this.storageName,e)}static loadValue(e){let t=u.getCookie(e);return null==t?null:JSON.parse(t)}static saveValue(e,t){null!=t?u.setCookie(e,JSON.stringify(t)):u.removeCookie(e)}static setCookie(e,t,r){if("undefined"!=typeof document){var n="";if(r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3),n="; expires="+o.toUTCString()}document.cookie=e+"="+(t||"")+n+"; path=/"}}static getCookie(e){if("undefined"==typeof document)return null;for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}static removeCookie(e){this.setCookie(e,"")}}!function(e){e[e.Login=282]="Login",e[e.Logout=283]="Logout",e[e.NotFound=404]="NotFound",e[e.OK=200]="OK",e[e.Redirect=301]="Redirect",e[e.BadRequest=400]="BadRequest",e[e.Forbidden=403]="Forbidden",e[e.CustomError=700]="CustomError",e[e.ArgumentNull=705]="ArgumentNull",e[e.FieldNull=709]="FieldNull",e[e.ArgumentTypeIncorrect=710]="ArgumentTypeIncorrect",e[e.UserNotLogin=718]="UserNotLogin",e[e.NoPermission=726]="NoPermission",e[e.UserIdNull=727]="UserIdNull",e[e.ObjectNotExistWithId=728]="ObjectNotExistWithId"}(n||(n={})),r.d(t,"Service",function(){return o.a}),r.d(t,"formatData",function(){return o.b}),r.d(t,"Callback",function(){return i.a}),r.d(t,"Callbacks",function(){return i.b}),r.d(t,"ValueStore",function(){return s}),r.d(t,"LocalValueStore",function(){return a}),r.d(t,"CookieValueStore",function(){return u}),r.d(t,"StatusCodes",function(){return n}),r.d(t,"StatusCode",function(){return n})}])});
//# sourceMappingURL=index.min.js.map